Description: run libexec/fileshareset with kdesu rather than setuid
 Run fileshareset with kdesu rather than rely on it to be setuid. filesharelist
 should not need root permissions on standard debian install.
Author: Modestas Vainius <modax@debian.org>
Forwarded: no
Origin: vendor
Last-Update: 2010-05-31


Index: kde4libs/kio/kio/kfileshare.cpp
===================================================================
--- kde4libs.orig/kio/kio/kfileshare.cpp	2010-02-20 12:32:33.000000000 +0100
+++ kde4libs/kio/kio/kfileshare.cpp	2010-11-25 16:40:14.000000000 +0100
@@ -239,17 +239,19 @@
        return false;
 
     kDebug(7000) << path << "," << shared;
+    QString kdesu = ::findExe("kdesu");
     QString exe = ::findExe( "fileshareset" );
-    if (exe.isEmpty())
+    if (kdesu.isEmpty() || exe.isEmpty())
         return false;
 
     QStringList args;
+    args << "--" << exe;
     if ( shared )
         args << "--add";
     else
         args << "--remove";
     args << path ;
-    int ec = QProcess::execute( exe, args ); // should be ok, the perl script terminates fast
+    int ec = QProcess::execute( kdesu, args ); // should be ok, the perl script terminates fast
     kDebug(7000) << "exitCode=" << ec;
     bool ok = !ec;
     switch (ec) {
